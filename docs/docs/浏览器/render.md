# 浏览器运行原理

### 架构

#### 进程和线程

程序通过线程处理问题

线程依附于进程

进程是运行环境，程序的运行实例

特点：任意线程出错，进程崩溃；线程共享进程数据；进程间内容相互隔离；进程关闭，内存全部回收

> 进程间通信IPC：管道（包括无名管道和命名管道）、消息队列、信号量、共享存储、Socket、Streams
>     线程间通信：全局变量，消息，事件

#### 浏览器架构演进

单进程-多进程-面向服务的多进程

- 多进程：渲染进程，插件进程，网络进程，主进程，GPU进程

独立，隔离插件，内存回收，安全沙箱

new question：高资源占用，多进程重复副本，复杂体系架构，多场景

- 面向服务的多进程：什么是面向服务？

- - soa，面向服务架构
  - 服务化，多个service
  - 拆分耦合模块，通过IPC通信

> 所有的页面，其实就是个图片

### 渲染

代码是如何变成页面的？

#### 流程

构建dom树-样式计算-布局计算-分层-图册绘制-栅格化-绘制

- 样式计算：css结构化转换-属性标准化-计算dom树样式（继承规则，层叠规则）
- 布局计算
- 分层：把同层的东西放在一起进行整合
- 图层绘制：根据绘制列表进行绘制操作，类似canvas根据坐标样式绘制矩形，图形，圆形。。。
- 栅格化：图块切分，视口优先（优先渲染用户看到的区域），GPU加速
- 渲染绘制：

### 编译器+解释器

#### v8如何解析js代码？

编译器-解析器-ast-字节码-JIT

语言有编译型语言，解释型语言

js是解释型语言，准确的说，js不完全算是解释型语言，解释型语言不需要编译成字节码这一步，但是js有，不过并不是必须的。

- 编译器：词法分析，语法分析
- 解析器：
- AST：语义分析
- 字节码：为了效率而引入的一种东西，是代码和机器码的中间状态，能描述源码，比较快的编译成机器码
- JIT：代码优化，实时做一个编译版本，热点代码

## 问题

1. 为什么css动画渲染性能比js好

一帧里渲染有7个步骤，因为css动画不需要影响到dom树，可以跳过布局和绘制的阶段，性能比较快

1. 性能优化

- 服务端渲染
- 压缩，合并
- link script异步化