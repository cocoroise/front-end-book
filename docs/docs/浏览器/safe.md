# 关于xss攻击和csrf攻击

### 介绍

前端常见的两种攻击模式，跨站脚本攻击(XSS)和跨站请求伪造攻击(CSRF)，这篇介绍一哈他们的攻击方式，和防御方式。

### XSS(跨站脚本攻击)

`XSS` 全称是 `Cross Site Scripting`(即`跨站脚本`)，为了和 CSS 区分，故叫它`XSS`。XSS 攻击是指浏览器中执行恶意脚本(无论是跨域还是同域)，从而拿到用户的信息并进行操作。

这些操作一般可以完成下面这些事情:

1. 窃取`Cookie`。
2. 监听用户行为，比如输入账号密码后直接发送到黑客服务器。
3. 修改 DOM 伪造登录表单。
4. 在页面中生成浮窗广告。

#### 攻击方式

1. 存储型，把恶意脚本存储到服务端，比如在留言区输入一段js代码，存到了数据库，然后在页面渲染的时候直接执行了
2. 反射型，在url上拼接一段参数，参数内容是一些js代码
3. 文档型，作为中间人的角色，劫持网络数据包，修改里面的html文档（浮窗广告）

#### 防御

1. 千万不要相信用户的任何输入，对用户输入的数据进行转码
2. 利用csp，浏览器的内容安全策略，限制其他域的资源加载，禁止向其他域提交数据等
3. 利用httpOnly，设置 Cookie 的 HttpOnly 属性后，JavaScript 便无法读取 Cookie 的值。

### CSRF(跨站请求伪造)

CSRF(Cross-site request forgery), 即跨站请求伪造，指的是黑客诱导用户点击链接，打开黑客的网站，然后黑客利用用户**目前的登录状态**发起跨站请求。

#### 攻击方式

1. 自动发送get请求

   ```
   <img src="https://xxx.com/info?user=hhh&count=100">
   ```

   如果用户已经登陆过，点击了这个图片，就会自动发送一个get请求

2. 自动发post请求

   黑客可能自己填了一个表单，写了一段自动提交的脚本，同样会携带用户的cookies信息，让服务器以为是正常的用户在进行操作。

和`XSS`攻击对比，CSRF 攻击并不需要将恶意代码注入用户当前页面的`html`文档中，而是跳转到新的页面，利用服务器的**验证漏洞**和**用户之前的登录状态**来模拟用户进行操作。

#### 防御

1. 利用cookies的samesite属性

   因为csrf攻击最重要的就是用了用户之前的cookies，所以我们只要限制cookies的使用，就能有效的进行防御。

   `SameSite`可以设置为三个值，`Strict`、`Lax`和`None`。

   一般我们都设置成none,如果我们设置成strict，就能限制浏览器不能在其他的域名下携带cookies。比如请求`sanyuan.com`网站只能在`sanyuan.com`域名当中请求才能携带 Cookie，在其他网站请求都不能。

2. 验证来源站点

   这就需要要用到请求头中的两个字段: **Origin**和**Referer**。

   其中，**Origin**只包含域名信息，而**Referer**包含了`具体`的 URL 路径。

   当然，这两者都是可以伪造的，通过 Ajax 中自定义请求头即可，安全性略差。

3. token机制

   服务器端在登陆时给客户端一个token，每次请求的时候都要带上这个token才能请求成功。