# lernaä½¿ç”¨

> lernaæ˜¯ä¸€ä¸ªç®¡ç†å¤špackageçš„npmå·¥å…·ã€‚

### ğŸˆç°çŠ¶
ä»“åº“åœ¨ä¸€æ®µæ—¶é—´ä¹‹åå˜å¾—è¶Šæ¥è¶Šå¤§ï¼Œå¦‚æœæƒ³åˆ†åˆ«ç®¡ç†ä»“åº“çš„ä¾èµ–å’Œç‰ˆæœ¬ä¼šå¾ˆéº»çƒ¦ï¼Œå¦‚æœå‘ç‰ˆå’Œæµ‹è¯•ä¼šå¯¹æ‰€æœ‰çš„æ¨¡å—è¿›è¡Œæ›´æ–°å’Œæµ‹è¯•ï¼Œå·¥ä½œé‡è¾ƒå¤§ã€‚è¿™ä¸ªæ—¶å€™å°±å¯ä»¥ä½¿ç”¨`lerna`è¿›è¡Œç®¡ç†ï¼ŒæŠŠæ‰€æœ‰ç›¸å…³çš„æ¨¡å—éƒ½æ”¾åœ¨ä¸€ä¸ªä»“åº“ï¼Œä½†æ˜¯ä½¿ç”¨`lerna`è¿›è¡Œåˆ†åˆ«ç®¡ç†ï¼Œç‹¬ç«‹å‘å¸ƒã€‚ 

### ğŸ¨ç¤ºä¾‹
æ¯ä¸ªæ¨¡å—ç”¨ä¸€ä¸ªå•ç‹¬çš„ä»“åº“ç®¡ç†ï¼Œå¦‚`webpack`ï¼Œ`webpack`ä¸‹çš„`webpack-cli`å’Œ`webpack-dev-server`ã€‚  
![](http://image.cocoroise.cn/image/lerna-1.png)

æ¯ä¸ªæ¨¡å—ç”¨ä¸€ä¸ªä»“åº“ç®¡ç†ï¼Œä½¿ç”¨æ ‡å‡†çš„æ–‡ä»¶å¤¹æ ¼å¼è¿›è¡ŒåŒºåˆ†ï¼Œåˆ†åˆ«æŒ‡å®šä¾èµ–ã€‚å¦‚`babel`ä»“åº“å’Œå¹´ä¹…å¤±ä¿®çš„`mint-ui`ã€‚`babel`åœ¨å®‰è£…çš„æ—¶å€™éœ€è¦åˆ†åˆ«å®‰è£…`babel`å’Œ`bable-core`ç­‰ç­‰,æœ‰æ—¶å€™å‡ ä¸ªç‰ˆæœ¬ä¸å…¼å®¹è¿˜ä¼šæŠ¥é”™ã€‚
````
npm install --save-dev @babel/core @babel/cli @babel/preset-env
npm install --save @babel/polyfill
````
![](http://image.cocoroise.cn/image/lerna-2.png)


### ğŸlernaçš„å®‰è£…
````
npx lerna init
````
æˆ–è€…
````
npm i -g lerna
lerna init
````
å®‰è£…äº†ä¹‹åä¼šè‡ªåŠ¨åœ¨æ ¹ç›®å½•æ·»åŠ `lerna.json`æ–‡ä»¶ï¼Œå’Œ`packages`æ–‡ä»¶å¤¹ã€‚  
Lerna æä¾›ä¸¤ç§ä¸åŒçš„æ–¹å¼æ¥ç®¡ç†ä½ çš„é¡¹ç›®ï¼š`Fixed` æˆ– `Independent`ï¼Œé»˜è®¤é‡‡ç”¨ `Fixed` æ¨¡å¼ï¼Œå¦‚æœä½ æƒ³é‡‡ç”¨ `Independent` æ¨¡å¼ï¼Œåªéœ€åœ¨æ‰§è¡Œ `init` å‘½ä»¤çš„æ—¶å€™åŠ ä¸Š --`independent` æˆ– `-i` å‚æ•°å³å¯ã€‚   

#### å›ºå®šæ¨¡å¼
å›ºå®šæ¨¡å¼ä¸‹lernaåœ¨å•ä¸€ç‰ˆæœ¬çº¿ä¸Šè¿è¡Œã€‚ç‰ˆæœ¬å·ä¿å­˜åœ¨`lerna.json`æ–‡ä»¶ä¸‹çš„`version`å­—æ®µé‡Œé¢ã€‚å¦‚æœä¸€ä¸ªæ¨¡å—åœ¨ä¸Šæ¬¡å‘å¸ƒä¹‹åæœ‰æ›´æ–°ï¼Œå®ƒä¼šè‡ªåŠ¨æ›´æ–°åˆ°è¿™é‡Œä½ è¦å‘å¸ƒçš„ç‰ˆæœ¬ã€‚   

#### ç‹¬ç«‹æ¨¡å¼
ç‹¬ç«‹æ¨¡å¼ä¸‹æ¯ä¸ªæ¨¡å—éƒ½æœ‰å®ƒç‹¬ç«‹çš„ç‰ˆæœ¬ã€‚æ¯æ¬¡å‘å¸ƒæ—¶éƒ½èƒ½æ”¶åˆ°æ¯ä¸ªåŒ…æ›´æ–°çš„æç¤ºã€‚åœ¨è¿™ä¸ªæ¨¡å¼ä¸‹`lerna.json`çš„`version`å€¼å°†ä¼šè¢«å¿½ç•¥ã€‚   

### ğŸ¯lernaçš„ä½¿ç”¨
åˆ›å»ºä¸€ä¸ªlernaç®¡ç†çš„æ¨¡å—ã€‚
````
$ lerna create <name> [location]
````
å¼•å…¥ä¸€ä¸ªlernaç®¡ç†çš„æ¨¡å—ã€‚
````
$ lerna import <git_dir>
````
æŸ¥çœ‹lernaä¸‹æ‰€æœ‰ç®¡ç†çš„åŒ…ã€‚
````
lerna list
````
æ·»åŠ éƒ¨åˆ†ä¾èµ–åŒ…
````
$ lerna add <package>[@version] [--dev] [--exact]
````
å½“æˆ‘ä»¬æ‰§è¡Œæ­¤å‘½ä»¤åï¼Œå°†ä¼šæ‰§è¡Œä¸‹é¢é‚£2ä¸ªåŠ¨ä½œï¼š

1. åœ¨æ¯ä¸€ä¸ªç¬¦åˆè¦æ±‚çš„æ¨¡å—é‡Œå®‰è£…æŒ‡æ˜çš„ä¾èµ–åŒ…ï¼Œç±»ä¼¼äºåœ¨æŒ‡å®šæ¨¡å—æ–‡ä»¶å¤¹ä¸­æ‰§è¡Œ `npm install <package>`ã€‚
2. æ›´æ–°æ¯ä¸ªå®‰è£…äº†è¯¥ä¾èµ–åŒ…çš„æ¨¡å—ä¸­çš„ `package.json` ä¸­çš„ä¾èµ–åŒ…ä¿¡æ¯

å®‰è£…æ‰€æœ‰ä¾èµ–åŒ…
````
lerna bootstrap
````
å½“æ‰§è¡Œå®Œä¸Šé¢çš„å‘½ä»¤åï¼Œä¼šå‘ç”Ÿä»¥ä¸‹çš„è¡Œä¸ºï¼š

1. åœ¨å„ä¸ªæ¨¡å—ä¸­æ‰§è¡Œ `npm install` å®‰è£…æ‰€æœ‰ä¾èµ–
2. å°†æ‰€æœ‰ç›¸äº’ä¾èµ–çš„ `Lerna` æ¨¡å— é“¾æ¥åœ¨ä¸€èµ·
3. åœ¨å®‰è£…å¥½ä¾èµ–çš„æ‰€æœ‰æ¨¡å—ä¸­æ‰§è¡Œ `npm run prepublish`
4. åœ¨å®‰è£…å¥½ä¾èµ–çš„æ‰€æœ‰æ¨¡å—ä¸­æ‰§è¡Œ `npm run prepare`   

### ğŸ› lernaçš„é…ç½®

å…¬å…±æ¨¡å—ä½¿ç”¨ä¸€ä¸ª`package.json`å’Œ`lerna.json`ï¼Œå…¶ä»–çš„æ¨¡å—æ”¾åœ¨`packages`æ–‡ä»¶å¤¹ä¸‹ï¼Œå•ç‹¬ç»´æŠ¤`package.json`æ–‡ä»¶ã€‚
```
my-lerna-repo/
    â”£â” packages/
    â”ƒ     â”£â” package-1/
    â”ƒ     â”ƒ      â”£â” ...
    â”ƒ     â”ƒ      â”—â” package.json
    â”ƒ     â”—â” package-2/
    â”ƒ            â”£â” ...
    â”ƒ            â”—â” package.json
    â”£â” ...
    â”£â” lerna.json
    â”—â” package.json
```

### ğŸ’»å‚è€ƒ
[æ‰‹æ‘¸æ‰‹æ•™ä½ ç©è½¬ Lerna](http://www.uedlinker.com/2018/08/17/lerna-trainning/)
